# extern关键字

## 符号的声明与定义

**面试官：** 你能解释一下C++中声明和定义的区别吗？

**求职者：** 好的。声明是告诉编译器某个符号的存在和类型，但不分配内存；定义则是真正创建对象并分配内存。比如`int x;`是定义，而`extern int x;`是声明。

**面试官：** 很好，那你知道为什么需要extern关键字吗？

**求职者：** extern主要用于告诉编译器这个变量或函数在别的地方定义了，我这里只是声明。这在多文件编程中特别重要，可以让不同文件共享全局变量。

### 变量

**面试官：** 那我们来具体看看变量的情况。如果我在一个文件中定义了全局变量，另一个文件要使用它，应该怎么做？

**求职者：** 首先在定义文件中正常定义变量，比如`int global_var = 10;`。然后在使用文件中用extern声明：`extern int global_var;`。这样就能访问同一个变量了。

**面试官：** 如果不加extern会怎样？

**求职者：** 不加extern的话，每个文件都会创建自己的变量实例，这就成了不同的变量，而且链接时可能出现重定义错误。

**代码练习：** [全局变量共享练习](../.CodeReference/extern/global_variable_demo.cpp)

### 函数

**面试官：** 函数的extern使用有什么特点？

**求职者：** 函数默认就有extern链接属性，所以通常不需要显式写extern。不过在函数声明时写extern也是合法的，只是习惯上我们省略。

**面试官：** 那什么时候必须用extern呢？

**求职者：** 主要是在C++调用C函数时，需要用`extern "C"`来指定C链接方式，防止C++的名字修饰影响链接。在编译时需要采用分离编译的方式，即把C函数和C++函数分别编译成不同的目标文件，然后链接在一起。

**代码练习：** [C/C++混合编程练习](../.CodeReference/extern/c_linkage_demo.cpp)

## C++中的链接属性

**面试官：** 你能说说C++中有哪些链接属性吗？

**求职者：** 主要有三种：外部链接（external linkage）、内部链接（internal linkage）和无链接（no linkage）。

**面试官：** 能详细解释一下吗？

**求职者：**

- 外部链接：可以被其他翻译单元访问，比如普通的全局变量和函数
- 内部链接：只能在当前翻译单元内访问，比如static全局变量
- 无链接：局部变量和函数参数，只在局部作用域有效

**面试官：** const变量的链接属性有什么特殊之处？

**求职者：** const全局变量默认是内部链接的，这和普通全局变量不同。如果要让const变量有外部链接，必须显式用extern修饰。

## extern的作用

**面试官：** 总结一下extern的主要作用吧。

**求职者：** extern主要有四个作用：

1. **声明全局变量**：在头文件中声明，在源文件中定义，实现多文件共享
2. **指定链接方式**：`extern "C"`用于C/C++混合编程
3. **控制链接属性**：让const变量具有外部链接
4. **模板特化声明**：在模板编程中声明外部特化

**面试官：** 在实际项目中，extern使用有什么注意事项？

**求职者：** 几个要点：

- 尽量在头文件中用extern声明，避免直接包含定义
- 注意初始化问题，extern声明的变量不能同时初始化
- 小心命名空间，extern声明要在正确的命名空间中
- 避免循环依赖，合理组织头文件结构

**代码练习：** [extern综合应用练习](../.CodeReference/extern/extern_comprehensive_demo.cpp)

---

**面试小贴士：** extern是多文件编程的基础，掌握好声明和定义的区别，以及链接属性的概念，对理解大型项目的代码组织很有帮助。
