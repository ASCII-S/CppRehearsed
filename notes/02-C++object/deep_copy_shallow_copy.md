# 深拷贝和浅拷贝

**面试官：** 你能说说C++里什么是浅拷贝，什么是深拷贝吗？

**求职者：** 当然可以！浅拷贝就是把对象的各个成员变量的值逐个复制一遍，如果成员变量是指针，那只是复制了指针的地址，两个对象会指向同一块内存。深拷贝则是除了复制基本类型，还会为指针成员分配新的内存，并把原内容拷贝过去，实现真正的“独立副本”。

**面试官：** 那浅拷贝会带来什么问题？

**求职者：** 最大的问题就是“悬垂指针”和“重复释放”。比如两个对象指向同一块堆内存，当一个对象析构释放内存后，另一个对象的指针就成了野指针。如果两个对象都析构，还会导致同一块内存被释放两次，程序崩溃。

**面试官：** C++默认的拷贝构造函数和赋值运算符是浅拷贝还是深拷贝？

**求职者：** 默认是浅拷贝。只有你自己实现拷贝构造函数和赋值运算符，才能实现深拷贝。

**面试官：** 那你能说说深拷贝的实现方式吗？

**求职者：** 一般来说，深拷贝需要：
1. 在拷贝构造函数里为指针成员分配新内存，并复制内容。
2. 在赋值运算符重载里先释放原有内存，再分配新内存并复制内容。
3. 注意自赋值和异常安全。

**面试官：** 有没有什么经典的面试陷阱？

**求职者：** 有的！比如：
- 如果类里有指针成员但没写深拷贝，面试官会问你析构时会不会出bug。
- 还有“自赋值”问题：`a = a;`，如果不判断，可能会先释放内存再拷贝自己，导致数据丢失。
- 还有资源泄漏、异常安全等问题。

**面试官：** 能不能举个代码例子？

**求职者：** 比如有个简单的String类，里面有char*成员，浅拷贝和深拷贝的区别就很明显。

让我们通过一个小练习来深入理解：[深拷贝与浅拷贝练习](../../MyOutput/02-C++object/CodeOut/deep_copy_shallow_copy/deep_copy_shallow_copy_demo.cpp)

---

> 代码练习：请在`MyOutput/02-C++object/CodeOut/deep_copy_shallow_copy/deep_copy_shallow_copy_demo.cpp`中，按如下TODO任务逐步完成：
> 1. 定义一个简单的String类，包含char*成员。
> 2. 实现默认拷贝构造和赋值运算符，观察浅拷贝带来的问题。
> 3. 手动实现深拷贝的拷贝构造函数和赋值运算符。
> 4. 在main中演示浅拷贝和深拷贝的不同效果。
> 5. 总结深拷贝和浅拷贝的区别和注意事项。

> 答案参考见：[Solution/deep_copy_shallow_copy_demo.cpp](../../MyOutput/02-C++object/CodeOut/deep_copy_shallow_copy/Solution/deep_copy_shallow_copy_demo.cpp)

